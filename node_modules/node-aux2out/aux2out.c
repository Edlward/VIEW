#include "aux2out.h"

#define AUX_TIP_SET() gpio_set_output(SUNXI_PORT_D_BASE, SUNXI_PIO_15)
#define AUX_TIP_CLR() gpio_clear_output(SUNXI_PORT_D_BASE, SUNXI_PIO_15)
#define AUX_RING_SET() gpio_set_output(SUNXI_PORT_D_BASE, SUNXI_PIO_14)
#define AUX_RING_CLR() gpio_clear_output(SUNXI_PORT_D_BASE, SUNXI_PIO_14)

//var AUXTIP_OUT = 111;
//var AUXRING_OUT = 110;
//var HOTSHOE_IN = 34;

uint8_t aux2out_init()
{
    gpio_init();

    gpio_cfg_output(SUNXI_PORT_D_BASE, SUNXI_PIO_15_IDX);
    gpio_cfg_output(SUNXI_PORT_D_BASE, SUNXI_PIO_14_IDX);

    AUX_RING_CLR();
    AUX_TIP_CLR();

    return 0;
}

uint8_t _aux2out_set(uint8_t status) {
    if(status)
    {
        return AUX_TIP_SET();
    }
    else
    {
        return AUX_TIP_CLR();
    }
}

uint8_t aux2out_pulse(uint32_t lengthMs, uint8_t invert)
{
    if(lengthMs)
    {
        _aux2out_set(invert ? 1 : 0);
        usleep(lengthMs * 1000);
        _aux2out_set(invert ? 0 : 1);
    }
    else
    {
        _aux2out_set(invert ? 0 : 1);
    }
    return 0;
}


